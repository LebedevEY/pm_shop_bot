# Система управления интернет-продажами

Это приложение для управления интернет-продажами с административной панелью и Telegram-ботом для пользователей.

## Технологии

- **Backend:** Node.js, Express, PostgreSQL, TypeORM
- **Frontend (админка):** React (можно использовать React-admin или Ant Design Pro)
- **Telegram-бот:** node-telegram-bot-api
- **Email:** Nodemailer
- **Аутентификация:** JWT

## Функциональность

1. REST API на Express
2. PostgreSQL и TypeORM для работы с БД
3. Модели: User (роли — admin, user), Product (CRUD), Order (оформление заказа пользователями), Notification (логи уведомлений)
4. Регистрация и авторизация пользователей (для админки и бота)
5. Админка — добавление/редактирование/удаление и просмотр товаров и заказов, фильтрация заказов
6. Telegram-бот — просмотр товаров, оформление заказа, подтверждение заказа, запрос контактных данных
7. Отправка уведомлений в Telegram и на email администратора после оформления заказа

## Установка и запуск

### Предварительные требования

- Node.js (версия 14 или выше)
- PostgreSQL (версия 12 или выше)
- Yarn

### Установка

1. Клонировать репозиторий

```bash
git clone <url-репозитория>
cd popmart_bot
```

2. Установить зависимости

```bash
yarn install
```

3. Создать файл .env на основе .env.example и заполнить его необходимыми данными

```bash
cp .env.example .env
# Отредактировать .env файл
```

4. Создать базу данных в PostgreSQL

```bash
psql -U postgres
CREATE DATABASE popmart;
\q
```

### Запуск

1. Запустить приложение в режиме разработки

```bash
yarn dev
```

2. Для продакшн-сборки

```bash
yarn build
yarn start
```

## Структура проекта

```
project-root/
├── src/
│   ├── config/              # Конфигурация приложения
│   ├── controllers/         # REST API контроллеры
│   ├── entities/            # Модели TypeORM
│   ├── migrations/          # Миграции базы данных
│   ├── repositories/        # Кастомные репозитории (если нужны)
│   ├── services/            # Бизнес-логика
│   ├── telegram/            # Все связанное с Telegram ботом
│   ├── middleware/          # Middleware для Express
│   ├── utils/               # Вспомогательные функции
│   ├── types/               # Типы и интерфейсы
│   └── app.ts               # Точка входа в приложение
├── client/                  # React-админка (будет добавлена позже)
├── package.json
├── tsconfig.json
└── README.md
```

## API Endpoints

### Аутентификация

- `POST /api/auth/register` - Регистрация нового пользователя
- `POST /api/auth/login` - Авторизация пользователя

### Товары

- `GET /api/products` - Получение списка товаров
- `GET /api/products/:id` - Получение информации о товаре
- `POST /api/products` - Создание нового товара (только для админа)
- `PUT /api/products/:id` - Обновление товара (только для админа)
- `DELETE /api/products/:id` - Удаление товара (только для админа)

### Заказы

- `GET /api/orders` - Получение списка заказов (для админа - все заказы, для пользователя - только свои)
- `GET /api/orders/:id` - Получение информации о заказе
- `POST /api/orders` - Создание нового заказа
- `PATCH /api/orders/:id/status` - Обновление статуса заказа (только для админа)

## Telegram-бот

Команды бота:

- `/start` - Начало работы с ботом
- `/products` - Просмотр списка доступных товаров
- `/product_<id>` - Просмотр информации о конкретном товаре
- `/order_<id>` - Оформление заказа на товар
